# Docker部署指南

## 前置条件

1. 安装Docker Desktop
    - Windows: https://www.docker.com/products/docker-desktop
    - Mac: https://www.docker.com/products/docker-desktop
    - Linux: `sudo apt-get install docker.io docker-compose`

2. 确保Docker服务正在运行

## 部署步骤

### 1. 打包项目
```bash
# 清理并打包
mvn clean package -DskipTests

# 确认jar包生成
ls target/course-management-1.0.0.jar
```

### 2. 启动Docker容器
```bash
# 构建并启动所有服务
docker-compose up -d

# 查看容器状态
docker-compose ps

# 查看应用日志
docker-compose logs -f app
```

### 3. 验证部署

- 访问Swagger文档: http://localhost:8080/swagger-ui.html
- 测试注册接口
- 测试登录接口

### 4. 常用命令
```bash
# 停止所有服务
docker-compose down

# 重启应用
docker-compose restart app

# 查看MySQL日志
docker-compose logs mysql

# 进入MySQL容器
docker exec -it course-mysql mysql -uroot -proot123

# 进入Redis容器
docker exec -it course-redis redis-cli

# 清理所有数据（包括数据卷）
docker-compose down -v
```

## 故障排查

### 问题1: 端口被占用
```bash
# 查看端口占用
netstat -ano | findstr 8080  # Windows
lsof -i:8080  # Mac/Linux

# 修改docker-compose.yml中的端口映射
```

### 问题2: 应用无法连接数据库
```bash
# 查看MySQL是否启动
docker-compose ps mysql

# 查看MySQL日志
docker-compose logs mysql

# 进入容器检查
docker exec -it course-mysql mysql -uroot -proot123 -e "SHOW DATABASES;"
```

### 问题3: 应用启动失败
```bash
# 查看详细日志
docker-compose logs app

# 重新构建镜像
docker-compose build --no-cache app
docker-compose up -d app
```

## 生产环境建议

1. **修改默认密码**: 修改MySQL和JWT密钥
2. **数据持久化**: 定期备份MySQL数据卷
3. **日志管理**: 配置日志文件持久化
4. **监控**: 添加健康检查和监控
5. **Nginx反向代理**: 使用Nginx作为反向代理